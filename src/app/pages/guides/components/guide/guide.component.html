<ul class="de-tabs">
  <li class="params" [class.active]="tab === 1" (click)="tab = 1">
    <span>{{ thelang.words["guides-tab-main"] }}</span>
  </li>
  <!--<li class="twitter" [class.active]="tab === 2" (click)="tab = 2;"><span>{{thelang.words['guides-tab-twitter']}}</span></li>-->
  <li class="links" [class.active]="tab === 3" (click)="tab = 3">
    <span>{{ thelang.words["guides-tab-links"] }}</span>
  </li>
  <li class="tasks" [class.active]="tab === 4" (click)="tab = 4">
    <span>{{ thelang.words["guides-tab-tasks"] }}</span>
  </li>
</ul>

<!-- tab 1 -->
<ng-container *ngIf="tab === 1">
  <div class="de-head b-margined3">{{ thelang.words["guides-tab-main"] }}</div>
  <div class="b-margined3">
    <radio-by-entity
      [items]="ll"
      [(value)]="selectedLang"
      visibleField="slug"
      [title]="thelang.words['common-lang'] + ':'"
    ></radio-by-entity>
  </div>
  <div class="generic-form">
    <div class="gf-param b-margined3" *ngIf="x.id">
      <div class="gfp-title b-margined1"><label>ID</label></div>
      <div class="gfp-inputwrap">
        <input class="small" type="text" [value]="x.id" disabled />
      </div>
    </div>
    <div class="gf-param b-margined3" *ngIf="x.id">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-created-at"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <input
          type="text"
          [value]="x.formattedDate('created_at', true)"
          disabled
        />
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label [class.required]="isRequired('cat_id')">{{
          thelang.words["guides-cat"]
        }}</label>
      </div>
      <div class="gfp-inputwrap">
        <div class="inputwithbtns">
          <select-simple
            [(value)]="x.cat_id"
            field="name"
            sortBy="pos"
            entity="cat"
            [multilang]="true"
            [useSearch]="false"
            [useNull]="true"
            [error]="errors.cat_id"
          ></select-simple>
          <div *ngIf="x.cat_id" class="iwb-btns">
            <a
              class="roundbtn link"
              target="_blank"
              href="/catalogue/cats/edit/{{ x.cat_id }}"
              ><span></span
            ></a>
          </div>
        </div>
      </div>
      <div class="gfp-error" *ngIf="errors.cat_id">
        {{ thelang.words[errors.cat_id] }}
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <!-- <label [class.required]="isRequired('cat_id')">{{
          thelang.words["guides-cat"]
        }}</label> -->
        <label [class.required]="isRequired('cat_id')">Type</label>
      </div>
      <div class="gfp-inputwrap">
        <div class="inputwithbtns">
          <select-simple
            [(value)]="x.type"
            field="name"
            sortBy="pos"
            entity="guide_type"
            [multilang]="true"
            [useSearch]="false"
            [useNull]="true"
            [error]="errors.type"
          ></select-simple>
        </div>
      </div>
      <!-- <div class="gfp-error" *ngIf="errors.type">
        {{ thelang.words[errors.type] }}
      </div> -->
    </div>
    <div
      *ngIf="x.type === limitAfterAuthGuideType || x.type === 3"
      class="gf-param b-margined3"
    >
      <div class="gfp-title b-margined1">
        <label>Visible steps limit</label>
      </div>
      <div class="gfp-inputwrap">
        <input type="number" class="small" [(ngModel)]="x.steps_limit" />
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label [class.required]="isRequired('name')"
          >{{ thelang.words["guides-name"] }} ({{ selectedLang.slug }})</label
        >
      </div>
      <div class="gfp-inputwrap">
        <input
          type="text"
          [dir]="selectedLang.dir"
          [(ngModel)]="x.translation(selectedLang.id).name"
          [class.error]="errors.name"
        />
      </div>
      <div class="gfp-error" *ngIf="errors.name">
        {{ thelang.words[errors.name] }}
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label [class.required]="isRequired('contentshort')"
          >{{ thelang.words["guides-contentshort"] }} ({{
            selectedLang.slug
          }})</label
        >
      </div>
      <div class="gfp-inputwrap">
        <textarea
          [dir]="selectedLang.dir"
          [(ngModel)]="x.translation(selectedLang.id).contentshort"
          [class.error]="errors.contentshort"
        ></textarea>
      </div>
      <div class="gfp-error" *ngIf="errors.contentshort">
        {{ thelang.words[errors.contentshort] }}
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label [class.required]="isRequired('content')"
          >{{ thelang.words["guides-content"] }} ({{
            selectedLang.slug
          }})</label
        >
      </div>
      <div class="gfp-inputwrap">
        <text-editor
          [dir]="selectedLang.dir"
          [(value)]="x.translation(selectedLang.id).content"
          [error]="errors.content"
        ></text-editor>
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-earnings"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <div class="selectwrap">
          <select [(ngModel)]="x.earnings">
            <option value="none">
              {{ thelang.words["guides-earnings-none"] }}
            </option>
            <option value="drop">
              {{ thelang.words["guides-earnings-drop"] }}
            </option>
            <option value="possible_drop">
              {{ thelang.words["guides-earnings-possible-drop"] }}
            </option>
            <option value="early_access">
              {{ thelang.words["guides-earnings-early-access"] }}
            </option>
            <option value="points">
              {{ thelang.words["guides-earnings-points"] }}
            </option>
          </select>
        </div>
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-invest"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <input type="number" class="small" [(ngModel)]="x.invest" />
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-bh-score"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <input type="number" class="small" [(ngModel)]="x.bh_score" />
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label [class.required]="isRequired('img')">{{
          thelang.words["guides-img"]
        }}</label>
      </div>
      <div class="gfp-inputwrap">
        <image-picker
          folder="guides"
          [(img)]="x.img"
          [error]="errors.img"
        ></image-picker>
      </div>
      <div class="gfp-error" *ngIf="errors.img">
        {{ thelang.words[errors.img] }}
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-status"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <div class="selectwrap">
          <select [(ngModel)]="x.status">
            <option value="current">
              {{ thelang.words["guides-status-current"] }}
            </option>
            <option value="ending">
              {{ thelang.words["guides-status-ending"] }}
            </option>
            <option value="expired">
              {{ thelang.words["guides-status-expired"] }}
            </option>
          </select>
        </div>
      </div>
    </div>
    <div class="gf-param b-margined3">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-hit"] }}</label>
      </div>
      <div class="gfp-inputwrap"><check-box [(value)]="x.hit"></check-box></div>
    </div>
    <div class="gf-param">
      <div class="gfp-title b-margined1">
        <label>{{ thelang.words["guides-active"] }}</label>
      </div>
      <div class="gfp-inputwrap">
        <check-box [(value)]="x.active"></check-box>
      </div>
    </div>
  </div>
</ng-container>

<!-- tab 2 -->
<!--
<ng-container *ngIf="tab === 2">
    <div class="de-head b-margined3">{{thelang.words['guides-tab-twitter']}}</div>
    <div class="generic-form">
        <div class="gf-param b-margined3">
            <div class="gfp-title b-margined1"><label>{{thelang.words['guides-twitter-score']}}</label></div>
            <div class="gfp-inputwrap"><input type="number" class="small" [(ngModel)]="x.twitter_score"></div>
        </div>
        <div class="gf-param b-margined3">
            <div class="gfp-title b-margined1"><label [class.required]="isRequired('twitter_username')">{{thelang.words['guides-twitter-username']}}</label></div>
            <div class="gfp-inputwrap"><input type="text" [(ngModel)]="x.twitter_username" [class.error]="errors.twitter_username"></div>
            <div class="gfp-error" *ngIf="errors.twitter_username">{{thelang.words[errors.twitter_username]}}</div>
        </div>
    </div>
</ng-container>
-->

<!-- tab 3 -->
<ng-container *ngIf="tab === 3">
  <div class="de-head b-margined3">{{ thelang.words["guides-tab-links"] }}</div>
  <div class="de-dash b-margined3">
    <div
      class="ded-btn roundbtn violet create"
      [title]="thelang.words['common-create']"
      (click)="linksCreate()"
    >
      <span></span>
    </div>
  </div>
  <div class="list inner b-margined3">
    <div class="l-wrap">
      <table>
        <tr class="no-selection">
          <th>{{ thelang.words["guidelinks-type"] }}</th>
          <th>{{ thelang.words["guidelinks-value"] }}</th>
          <th>
            <label
              [class.sorted-forward]="
                linksSortBy === 'pos' && linksSortDir === 1
              "
              [class.sorted-backward]="
                linksSortBy === 'pos' && linksSortDir === -1
              "
              (click)="linksChangeSorting('pos')"
              >{{ thelang.words["guidelinks-pos"] }}</label
            >
          </th>
          <th>{{ thelang.words["common-actions"] }}</th>
        </tr>
        <ng-container *ngIf="x.links.length">
          <tr *ngFor="let y of x.links; let i = index">
            <td>
              <select-simple
                [(value)]="y.linktype_id"
                field="name"
                sortBy="name"
                entity="linktype"
                [useNull]="!y.id"
              ></select-simple>
            </td>
            <td><input type="text" [(ngModel)]="y.value" /></td>
            <td><input class="small" type="number" [(ngModel)]="y.pos" /></td>
            <td>
              <div class="l-actions">
                <div
                  class="roundbtn danger delete"
                  [title]="thelang.words['common-delete']"
                  (click)="linksDelete(i)"
                >
                  <span></span>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <ng-container *ngIf="!x.links.length">
          <tr>
            <td>{{ thelang.words["common-empty"] }}</td>
          </tr>
        </ng-container>
      </table>
    </div>
  </div>
  <div class="de-dash">
    <div
      class="ded-btn roundbtn violet create"
      [title]="thelang.words['common-create']"
      (click)="linksCreate()"
    >
      <span></span>
    </div>
  </div>
</ng-container>

<!-- tab 4 -->
<ng-container *ngIf="tab === 4">
  <div class="de-head b-margined3">{{ thelang.words["guides-tab-tasks"] }}</div>
  <div class="de-dash b-margined3">
    <div
      class="ded-btn roundbtn violet create"
      [title]="thelang.words['common-create']"
      (click)="tasksCreate()"
    >
      <span></span>
    </div>
  </div>
  <div class="list inner b-margined3">
    <div class="l-wrap">
      <table>
        <tr class="no-selection">
          <th>{{ thelang.words["tasks-name"] }}</th>
          <th>{{ thelang.words["tasks-actual-until"] }}</th>
          <th>
            <label
              [class.sorted-forward]="
                tasksSortBy === 'pos' && tasksSortDir === 1
              "
              [class.sorted-backward]="
                tasksSortBy === 'pos' && tasksSortDir === -1
              "
              (click)="tasksChangeSorting('pos')"
              >{{ thelang.words["tasks-pos"] }}</label
            >
          </th>
          <th>{{ thelang.words["common-actions"] }}</th>
        </tr>
        <ng-container *ngIf="x.tasks.length">
          <tr *ngFor="let y of x.tasks; let i = index">
            <td>{{ y.translation(1)?.name }}</td>
            <td>
              <timestamp-picker
                [(value)]="y.actual_until"
                [resetable]="true"
                [resetvalue]="null"
              ></timestamp-picker>
            </td>
            <td><input class="small" type="number" [(ngModel)]="y.pos" /></td>
            <td>
              <div class="l-actions">
                <div
                  class="roundbtn edit"
                  [title]="thelang.words['common-edit']"
                  (click)="tasksEdit(i)"
                >
                  <span></span>
                </div>
                <div
                  class="roundbtn danger delete"
                  [title]="thelang.words['common-delete']"
                  (click)="tasksDelete(i)"
                >
                  <span></span>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
        <ng-container *ngIf="!x.tasks.length">
          <tr>
            <td>{{ thelang.words["common-empty"] }}</td>
          </tr>
        </ng-container>
      </table>
    </div>
  </div>
  <div class="de-dash">
    <div
      class="ded-btn roundbtn violet create"
      [title]="thelang.words['common-create']"
      (click)="tasksCreate()"
    >
      <span></span>
    </div>
  </div>
  <panel-task
    [x]="task"
    [ll]="ll"
    [(active)]="taskPanelActive"
    (apply)="tasksOnApply()"
  ></panel-task>
</ng-container>
