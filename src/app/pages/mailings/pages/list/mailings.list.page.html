<div class="page-head">
  <div class="ph-title">
    <div class="ph-h1">{{thelang.words["mailings-head"]}}</div>
    <div class="ph-h2">
      {{thelang.words["common-length"]}}: {{elementsQuantity}}
    </div>
  </div>
  <div class="ph-dash" *ngIf="ready">
    <div
      class="ph-btn roundbtn violet create"
      routerLink="{{homeUrl}}/create"
      [title]="thelang.words['common-create']"
    >
      <span></span>
    </div>
    <div
      class="ph-btn roundbtn red delete"
      [class.disabled]="!canBulk"
      (click)="deleteBulk()"
      [title]="thelang.words['common-deleteselected']"
    >
      <span></span>
    </div>
  </div>
  <div class="ph-loader" [class.active]="!ready || reloading"></div>
</div>

<div class="list">
  <div class="l-wrap">
    <ng-container *ngIf="ready">
      <table>
        <tr class="no-selection">
          <th class="compact">
            <check-box
              [(value)]="allSelected"
              (valueChange)="onSelectAll()"
            ></check-box>
          </th>
          <th class="compact">
            <label
              [class.sorted-forward]="sortBy === 'id' && sortDir === 1"
              [class.sorted-backward]="sortBy === 'id' && sortDir === -1"
              (click)="changeSorting('id')"
              >ID</label
            >
          </th>
          <th>
            <label
              [class.sorted-forward]="sortBy === 'created_at' && sortDir === 1"
              [class.sorted-backward]="sortBy === 'created_at' && sortDir === -1"
              (click)="changeSorting('created_at')"
              >{{thelang.words['mailings-created-at']}}</label
            >
          </th>
          <th>{{thelang.words['mailings-subject']}}</th>
          <th>{{thelang.words['mailings-status']}}</th>
          <th>{{thelang.words['common-actions']}}</th>
        </tr>
        <ng-container *ngIf="xl.length">
          <tr *ngFor="let x of xl">
            <td>
              <check-box
                *ngIf="!x.defended"
                [(value)]="x.__selected"
                (valueChange)="onSelect()"
              ></check-box>
            </td>
            <td>{{x.id}}</td>
            <td>{{x.formattedDate('created_at', true)}}</td>
            <td>{{x.subject}}</td>
            <td>
              {{thelang.words['mailings-status-'+x.status]}}&nbsp;<span
                *ngIf="x.status === 'running'"
                ><mailing-status [mailing]="x"></mailing-status
              ></span>
            </td>
            <td>
              <div class="l-actions">
                <!-- <a
                  *ngIf="x.status !== 'running'"
                  class="roundbtn mail"
                  [title]="thelang.words['mailings-run']"
                  (click)="runForAll(x)"
                  ><span></span
                ></a> -->
                <a
                  *ngIf="x.status !== 'running'"
                  class="roundbtn mail"
                  [title]="thelang.words['mailings-run']"
                  (click)="run(x)"
                  ><span></span
                ></a>
                <a
                  *ngIf="x.status !== 'running'"
                  class="roundbtn edit"
                  [title]="thelang.words['common-edit']"
                  routerLink="{{homeUrl}}/edit/{{x.id}}"
                  ><span></span
                ></a>
                <a
                  *ngIf="!x.defended && x.status !== 'running'"
                  class="roundbtn danger delete"
                  [title]="thelang.words['common-delete']"
                  (click)="delete(x.id)"
                  ><span></span
                ></a>
              </div>
            </td>
          </tr>
        </ng-container>
        <ng-container *ngIf="!xl.length">
          <tr>
            <td>{{thelang.words['common-empty']}}</td>
          </tr>
        </ng-container>
      </table>
    </ng-container>
  </div>
  <div class="l-foot">
    <pagination
      [n]="pagesQuantity"
      [(current)]="part"
      (currentChange)="initList(true)"
    ></pagination>
  </div>
  <div class="l-loading" [class.active]="reloading"></div>
</div>
